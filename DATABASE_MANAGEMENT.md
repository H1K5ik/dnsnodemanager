# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö DNS Node Manager

## üìã –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

DNS Node Manager –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **MySQL** –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ë–î
- **–§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**: `server/config/database.yml`
- **–•–æ—Å—Ç**: localhost:3306
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: dnsnodemanager
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**: dnsnm_user
- **–ü–∞—Ä–æ–ª—å**: dnsnm123

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:
- **`user`** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã
- **`server`** - DNS —Å–µ—Ä–≤–µ—Ä—ã
- **`ns_group`** - –≥—Ä—É–ø–ø—ã nameserver'–æ–≤
- **`ns_group_member`** - —Å–≤—è–∑—å —Å–µ—Ä–≤–µ—Ä–æ–≤ —Å –≥—Ä—É–ø–ø–∞–º–∏
- **`zone`** - DNS –∑–æ–Ω—ã
- **`record`** - DNS –∑–∞–ø–∏—Å–∏
- **`acl`** - —Å–ø–∏—Å–∫–∏ –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞
- **`forwarder`** - –≥—Ä—É–ø–ø—ã forwarder'–æ–≤
- **`view`** - DNS view'—ã
- **`audit`** - –∂—É—Ä–Ω–∞–ª –∞—É–¥–∏—Ç–∞

## üõ†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

```bash
cd server
node create_admin.js
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –°–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `admin` —Å –ø–∞—Ä–æ–ª–µ–º `admin123`

### 2. –û—á–∏—Å—Ç–∫–∞/—É–¥–∞–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
cd server
node cleanup_database.js
```

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –æ–ø—Ü–∏–∏**:
- `node cleanup_database.js 1` - –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã (–æ—Å—Ç–∞–≤–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É)
- `node cleanup_database.js 2` - –£–¥–∞–ª–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª–Ω–æ—Å—Ç—å—é
- `node cleanup_database.js 3` - –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ë–î

### 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ë–î

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

```bash
cd server
npm start
```

## üîß –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ MySQL

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:

```bash
mysql -h localhost -P 3306 -u dnsnm_user -pdnsnm123 dnsnodemanager
```

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:

```sql
-- –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã
SHOW TABLES;

-- –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ã
DESCRIBE zone;

-- –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö
SELECT 
    table_name,
    table_rows
FROM information_schema.tables 
WHERE table_schema = 'dnsnodemanager';

-- –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ (–æ—Å—Ç–∞–≤–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É)
SET FOREIGN_KEY_CHECKS = 0;
TRUNCATE TABLE acl;
TRUNCATE TABLE forwarder;
TRUNCATE TABLE ns_group;
TRUNCATE TABLE server;
TRUNCATE TABLE user;
TRUNCATE TABLE view;
TRUNCATE TABLE acl_usage;
TRUNCATE TABLE ns_group_member;
TRUNCATE TABLE zone;
TRUNCATE TABLE record;
TRUNCATE TABLE audit;
SET FOREIGN_KEY_CHECKS = 1;

-- –£–¥–∞–ª–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª–Ω–æ—Å—Ç—å—é
DROP DATABASE dnsnodemanager;
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è:

```bash
# –ß–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç
cd server
node cleanup_database.js 3

# –ß–µ—Ä–µ–∑ MySQL
mysql -h localhost -P 3306 -u dnsnm_user -pdnsnm123 -e "USE dnsnodemanager; SELECT COUNT(*) as total_zones FROM zone; SELECT COUNT(*) as total_servers FROM server; SELECT COUNT(*) as total_users FROM user;"
```

### –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ:

```bash
# –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø
mysqldump -h localhost -P 3306 -u dnsnm_user -pdnsnm123 dnsnodemanager > backup_$(date +%Y%m%d_%H%M%S).sql

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –±—ç–∫–∞–ø–∞
mysql -h localhost -P 3306 -u dnsnm_user -pdnsnm123 dnsnodemanager < backup_20231201_120000.sql
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ**: –í—Å–µ–≥–¥–∞ –¥–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø –ø–µ—Ä–µ–¥ –æ—á–∏—Å—Ç–∫–æ–π/—É–¥–∞–ª–µ–Ω–∏–µ–º –ë–î
2. **–ü–∞—Ä–æ–ª–∏**: –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–∞—Ä–æ–ª—å `admin123` - –∏–∑–º–µ–Ω–∏—Ç–µ –µ–≥–æ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
3. **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `dnsnm_user` –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –ë–î
4. **–í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏**: –ü—Ä–∏ –æ—á–∏—Å—Ç–∫–µ —Ç–∞–±–ª–∏—Ü –æ—Ç–∫–ª—é—á–∞—é—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è

## üîÑ –ü—Ä–æ—Ü–µ–¥—É—Ä—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

### –ü–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã:

1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –£–¥–∞–ª–∏—Ç—å –ë–î: `node cleanup_database.js 2`
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: `npm start` (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç –ë–î –∏ —Ç–∞–±–ª–∏—Ü—ã)
4. –°–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω–∞: `node create_admin.js`

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞:

1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ë–î –∏–∑ –±—ç–∫–∞–ø–∞
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

## üìù –õ–æ–≥–∏ –∏ –æ—Ç–ª–∞–¥–∫–∞

–õ–æ–≥–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤:
- `server/logs/` - –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- MySQL error log (–æ–±—ã—á–Ω–æ `/var/log/mysql/error.log`)

–î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î –≤–∫–ª—é—á–∏—Ç–µ debug —Ä–µ–∂–∏–º –≤ `server/config/database.yml`:

```yaml
database:
  debug: true  # –í–∫–ª—é—á–∏—Ç—å –æ—Ç–ª–∞–¥–æ—á–Ω—ã–µ –ª–æ–≥–∏
```
